<!doctype html>
<html class="no-js">
  <head>
    <meta charset="utf-8">
    <title></title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <link rel="stylesheet" href="styles/vendor.a005ed24.css">
    <link rel="stylesheet" href="styles/main.622af5cf.css">
  </head>
  <body ng-app="app">
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <a class="navbar-brand" href="#">EMC<sup>2</sup></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
          <ul class="nav navbar-nav">
            <li><a href="#">Products &amp; Solutions</a></li>
            <li><a href="#">Store</a></li>
            <li><a href="#">Services</a></li>
            <li><a href="#">Support</a></li>
            <li><a href="#">Communities</a></li>
            <li><a href="#">Partners</a></li>
            <li><a href="#">EMC&plus;</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li class="dropdown">
              <a
                href="#"
                class="dropdown-toggle"
                data-toggle="dropdown"
                role="button"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="glyphicon glyphicon-user"></i>
                User <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li role="separator" class="divider"></li>
                <li><a href="#">Separated link</a></li>
              </ul>
            </li>
          </ul>
        </div>
      </div><!-- /.container-fluid -->
    </nav>
    <!--
    <div class="divide-nav">
      <div class="container">
        <p class="divide-text">Some Text Here</p>
      </div>
    </div>
    -->

    <!--
    <nav class="navbar navbar-default navbar-lower" role="navigation">
      <div class="container">
        <div class="collapse navbar-collapse collapse-buttons">
          <form class="navbar-form navbar-left" role="search">
            <button class="btn btn-success">Button</button>
            <button class="btn btn-default">Button</button>
            <button class="btn btn-default">Button</button>
            <button class="btn btn-default">Button</button>
          </form>
        </div>
      </div>
    </nav>
    -->

    <div class="container">
      <div class="row">
        <ul class="nav nav-pills">
          <li role="presentation" class="active"><a href="#">Summary</a></li>
          <li role="presentation"><a href="#">Incident Management <span class="badge">5</span></a></li>
          <li role="presentation"><a href="#">Install Base</a></li>
          <li role="presentation"><a href="#">Risk/Health</a></li>
          <li role="presentation"><a href="#">Onsite Services</a></li>
        </ul>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <ul class="nav nav-pills">
          <li><a href="#">Account Management Team</a></li>
          <li><a href="#">S360 Health &amp; Risk</a></li>
          <li><a href="#">Service Actions &amp; Schedule</a></li>
        </ul>
      </div>
    </div>

    <div
      class="navbar navbar-default"
      style="background-color: #0F1418;"
    >
      <div class="container text-center">
        <div class="col-sm-2">
          <kpi:circle
            class="active"
            label="Active Escalations"
            value="27"
            color="#5343C2"
          ></kpi:circle>
        </div>
        <div class="col-sm-2 text-center">
          <kpi:circle
            label="Service Requests"
            value="17"
            color="#56D0DB"
          ></kpi:circle>
        </div>
        <div class="col-sm-4">
          <arc:gauge></arc:gauge>
        </div>
        <div class="col-sm-2">
          <kpi:circle
            label="Un-Remediated FCQ"
            value="6"
            color="#A93FD0"
          ></kpi:circle>
        </div>
        <div class="col-sm-2">
          <kpi:circle
            label="Un-Remediated TSEs"
            value="3"
            color="#369ADC"
          ></kpi:circle>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="row">
        <div class="col-sm-9">
          <div id="map" style="margin-bottom: -15px;"></div>
        </div>
        <div class="col-sm-3">
          Hello World
        </div>
      </div>
      <div class="row">
        <div class="filler"></div>
      </div>
    </div>

    <!--
    <div
      ng-include="'ui-questions/ui-questions.html'"
      ng-controller="QuestionsListViewController as vm"
    ></div>
    -->

    <!-- Google Analytics: change UA-XXXXX-X to be your site's ID -->
     <script>/*
       !function(A,n,g,u,l,a,r){A.GoogleAnalyticsObject=l,A[l]=A[l]||function(){
       (A[l].q=A[l].q||[]).push(arguments)},A[l].l=+new Date,a=n.createElement(g),
       r=n.getElementsByTagName(g)[0],a.src=u,r.parentNode.insertBefore(a,r)
       }(window,document,'script','//www.google-analytics.com/analytics.js','ga');

       ga('create', 'UA-XXXXX-X');
       ga('send', 'pageview');
    */</script>

    <script src="scripts/vendor.047eeebd.js"></script>

      <script src="scripts/scripts.62234695.js"></script>

      <script type="text/javascript">
        $('.navbar-lower').affix({
          offset: {top: 50}
        });
      </script>

<script>

// {'Name', position:Lat,Long
var activeEscalations = [
  {
    name: 'San Francisco',
    position: [37.774929,-122.419416],
    count: 2
  },
  {
    name: 'Mexico City',
    position: [19.432608,-99.133208],
    count: 5
  },
  {
    name: 'Chicago',
    position: [41.878114,-87.629798],
    count: 2
  },
  {
    name: 'New York',
    position: [40.714460,-74.008842],
    count: 13
  },
  {
    name: 'London',
    position: [51.507351,-0.127758],
    count: 18
  },
  {
    name: 'Brazil',
    position: [-7.013668,-57.480469],
    count: 3
  },
  {
    name: 'Chile',
    position: [-40.580585,-72.597656],
    count: 1
  },
  {
    name: 'Mediterania',
    position: [34.741612,37.089844],
    count: 0
  },
  {
    name: 'Russia',
    position: [66.089364,56.074219],
    count: 2
  },
  {
    name: 'Tokyo',
    position: [35.689487,139.691706],
    count: 12
  },
  {
    name: 'Sydney',
    position: [-33.867487,151.20699],
    count: 4
  }
];

var serviceRequests = [
  {
    name: 'San Francisco',
    position: [37.774929,-122.419416],
    count: 4
  },
  {
    name: 'Mediterania',
    position: [34.741612,37.089844],
    count: 3
  },
  {
    name: 'Chile',
    position: [-40.580585,-72.597656],
    count: 2
  },
  {
    name: 'London',
    position: [51.507351,-0.127758],
    count: 5
  }
];

var FCQs = [
  {
    name: 'San Francisco',
    position: [37.774929,-122.419416],
    count: 4
  },
  {
    name: 'Chicago',
    position: [41.878114,-87.629798],
    count: 2
  },
  {
    name: 'Tokyo',
    position: [35.689487,139.691706],
    count: 6
  },
  {
    name: 'London',
    position: [51.507351,-0.127758],
    count: 5
  }
];

var TSEs = [
  {
    name: 'San Francisco',
    position: [37.774929,-122.419416],
    count: 4
  },
  {
    name: 'Mediterania',
    position: [34.741612,37.089844],
    count: 3
  },
  {
    name: 'Chile',
    position: [-40.580585,-72.597656],
    count: 2
  },
  {
    name: 'London',
    position: [51.507351,-0.127758],
    count: 5
  }
];

var m_width = $("#map").width(),
    width = 938,
    height = 500,
    country,
    state;

var projection = d3.geo.mercator()
    .translate([width / 2, height / 1.5])
    .scale(140);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("#map").append("svg")
    .attr("preserveAspectRatio", "xMidYMid")
    .attr("viewBox", "0 0 " + width + " " + height)
    .attr("width", m_width)
    .attr("height", m_width * height / width);

svg.append("rect")
    .attr("class", "background")
    .attr("width", width)
    .attr("height", height)
    .on("click", country_clicked);

var g = svg.append("g");

d3.json("data/countries.topo.json", function(error, us) {
  g.append("g")
    .attr("id", "countries")
    .selectAll("path")
    .data(topojson.feature(us, us.objects.countries).features)
    .enter()
    .append("path")
    .attr("id", function(d) { return d.id; })
    .attr("d", path)
    .on("click", country_clicked);
});

function update(data, className) {

  svg.selectAll('circle').remove();

  svg.selectAll('circle')
    .data(data)
    .enter()
    .append('circle')
    .attr('r', '0')
    .transition()
    .duration(300)
    .ease('elastic')
    .attr({
      'class': ['bubble', className].join(' '),
      'cx': function(d) {
        return projection([d.position[1], d.position[0]])[0];
      },
      'cy': function(d) {
        return projection([d.position[1], d.position[0]])[1];
      },
      'r': function(d) {
        return d.count * 3;
      }
    });
}

function zoom(xyz) {
  g.transition()
    .duration(750)
    .attr("transform", "translate(" + projection.translate() + ")scale(" + xyz[2] + ")translate(-" + xyz[0] + ",-" + xyz[1] + ")")
    .selectAll(["#countries", "#states", "#cities"])
    .style("stroke-width", 1.0 / xyz[2] + "px")
    .selectAll(".city")
    .attr("d", path.pointRadius(20.0 / xyz[2]));
}

function get_xyz(d) {
  var bounds = path.bounds(d);
  var w_scale = (bounds[1][0] - bounds[0][0]) / width;
  var h_scale = (bounds[1][1] - bounds[0][1]) / height;
  var z = .96 / Math.max(w_scale, h_scale);
  var x = (bounds[1][0] + bounds[0][0]) / 2;
  var y = (bounds[1][1] + bounds[0][1]) / 2 + (height / z / 6);
  return [x, y, z];
}

function country_clicked(d) {
  g.selectAll(["#states", "#cities"]).remove();
  state = null;

  if (country) {
    g.selectAll("#" + country.id).style('display', null);
  }

  if (d && country !== d) {
    var xyz = get_xyz(d);
    country = d;

    if (d.id  == 'USA' || d.id == 'JPN') {
      d3.json("/json/states_" + d.id.toLowerCase() + ".topo.json", function(error, us) {
        g.append("g")
          .attr("id", "states")
          .selectAll("path")
          .data(topojson.feature(us, us.objects.states).features)
          .enter()
          .append("path")
          .attr("id", function(d) { return d.id; })
          .attr("class", "active")
          .attr("d", path)
          .on("click", state_clicked);

        zoom(xyz);
        g.selectAll("#" + d.id).style('display', 'none');
      });
    } else {
      zoom(xyz);
    }
  } else {
    var xyz = [width / 2, height / 1.5, 1];
    country = null;
    zoom(xyz);
  }
}

function state_clicked(d) {
  g.selectAll("#cities").remove();

  if (d && state !== d) {
    var xyz = get_xyz(d);
    state = d;

    country_code = state.id.substring(0, 3).toLowerCase();
    state_name = state.properties.name;

    d3.json("/json/cities_" + country_code + ".topo.json", function(error, us) {
      g.append("g")
        .attr("id", "cities")
        .selectAll("path")
        .data(topojson.feature(us, us.objects.cities).features.filter(function(d) { return state_name == d.properties.state; }))
        .enter()
        .append("path")
        .attr("id", function(d) { return d.properties.name; })
        .attr("class", "city")
        .attr("d", path.pointRadius(20 / xyz[2]));

      zoom(xyz);
    });
  } else {
    state = null;
    country_clicked(country);
  }
}

$(window).resize(function() {
  var w = $("#map").width();
  svg.attr("width", w);
  svg.attr("height", w * height / width);
});

$('body').on('click', '.kpi-circle', function(e) {

  var $btns = $('.kpi-circle');
  var obs = _.indexOf( $btns, this );
  if (0 === obs) {
    update(activeEscalations, 'active-escalation');
  } else
  if (1 === obs) {
    update(serviceRequests, 'service-request');
  } else
  if (2 === obs) {
    update(FCQs, 'fcq');
  } else
  if (3 === obs) {
    update(TSEs, 'tse');
  }

  $btns.removeClass('active');
  $(this).addClass('active');
});
</script>
</body>
</html>
